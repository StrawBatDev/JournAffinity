var mn=Object.defineProperty;var pn=(e,t,r)=>t in e?mn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Z=(e,t,r)=>pn(e,typeof t!="symbol"?t+"":t,r);import*as oe from"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/+esm";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function r(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=r(a);fetch(a.href,l)}})();let gn=(e,t,r)=>{navigator.clipboard.writeText(e).then(()=>{t()},()=>{})},hn=()=>{let e=document.querySelector("#copy-button .button-text");e.innerHTML="Copied!",setTimeout(()=>{e.innerHTML="Copy"},1e3)};const ke="preview",yn="Are you sure you want to reset? Your changes will be lost.",ot=["b","i","u","s","h1","h2","h3","h4","h5","left","center","right","sub","sup","quote","-----","color"],An=[/^@(\w+)$/,/^:(\w+)icon:$/,/^:icon(\w+):$/,/^@([a-zA-Z0-9_-]+):\1icon:/],bn=/\[\s*([0-9\-]+)\s*,\s*([0-9\-]+)\s*,\s*([0-9\-]+)\s*\]/,Tn=["\\[","/?","(",ot.join("|"),")","(=[^\\]]+)?","\\]"].join(""),et=`[h1]JournAffinity v1.0[/h1]
Hi, I am :strawbaticon: and this is an [b]WYSIWYG editor[/b] I made to help you write journals and post descriptions on Furaffinity.net!

If you like this software,  [b][url=https://ko-fi.com/strawbat$0][color=orange]consider supporting my work and make a donation to my Ko-Fi. Thank you[/color][/url][/b]

[h2]Dorky stuff translated for the layman:[/h2]
[b]Furaffinity.net[/b] uses what are called [b]BBCodes[/b] for formatting text; 
BBCode is a lightweight markup language used on many online forums and bulletin boards to format posts.

What I am doing is converting these BBCodes using Regex (Shorthand for 'regular expression') and converting them into HTML (Shorthand for hypertext markup language)
This text is then previewed using CSS (Shorthand for 'Cascading Style Sheets'), heavily inspired by Furaffinity.net's CSS circa 2025.

What you see in the preview should [i]approximate[/i] what you will see on Furaffinity.net when you post.

Things left to add:
- Link url button for inserting links
- Swap showing windows in favour of in page dialogs; this should fix the 'orphaning' issue which may be annoying to users.
- Add a preview to show submissions when inserting the sequence navigation links.
- Fix the preview of youtube videos, the thumbnails are misaligned. Functional, but not acurate.

[h2]Sauces:[/h2]
The BBCodes that this editor can preview have been based on this [url=https://www.furaffinity.net/journal/8342081/]journal[/url] and [url=https://www.furaffinity.net/help/#tags-and-codes]Furaffinity.net's official documentation[/url]

This is forked from another project here: https://markdownlivepreview.com

-----
[h1]Examples[/h1]
[b]Bold[/b]
[i]Italic[/i]
[u]Underline[/u]
[s]Strike-out[/s]
(c)(tm)(r)

Spoiler text: [spoiler]"BOO!"[/spoiler]
Comic navigation: [31017474, 42300460, 42402962]
Colored text: [color=orange]Orange you glad to see me?[/color]

Username only: @strawbat 
🐭 Username: @@strawbat
🐭 Username(Legacy)::iconstrawbat: 
🐭::strawbaticon:

[sup]TEXT[/sup] Makes text Small and Up
[sub]TEXT[/sub] Makes text Small and Bottom

Links: [url=LINK]TEXT HERE[/url] 

Text Alignment:
[left]Slide to the left![/left]
[center]Malcom in the middle![/center]
[right]Slide to the right![/right]

Combinations:
[i][b]Kamina - "We're gonna combine!"[/b][/i]
[b][url=https://www.youtube.com/watch?v=CzVeai1P1H0$0][color=orange]Simon - "They're going to combine?!"[/color][/url][/b]
    
Video links (Only in journals!)
[yt]https://www.youtube.com/watch?v=CzVeai1P1H0[/yt]
`;let tt=(e,t,r)=>{e.setValue(t),e.revealPosition({lineNumber:1,column:1}),e.focus(),r(!1)},wn=e=>{document.querySelector("#copy-button").addEventListener("click",t=>{t.preventDefault();let r=e.getValue();gn(r,()=>{hn()})})},_n=(e,t)=>{document.querySelector("#reset-button").addEventListener("click",r=>{r.preventDefault(),Sn(e,t)})},En=()=>{let e=.5;const t=document.getElementById("split-divider"),r=document.getElementById("edit"),o=document.getElementById("preview"),a=document.getElementById("container");let l=!1;t.addEventListener("mouseenter",()=>{t.classList.add("hover")}),t.addEventListener("mouseleave",()=>{l||t.classList.remove("hover")}),t.addEventListener("mousedown",()=>{l=!0,t.classList.add("active"),document.body.style.cursor="col-resize"}),t.addEventListener("dblclick",()=>{const T=a.getBoundingClientRect().width,w=t.offsetWidth,S=(T-w)/2;r.style.width=S+"px",o.style.width=S+"px"}),document.addEventListener("mousemove",m=>{if(!l)return;document.body.style.userSelect="none";const T=a.getBoundingClientRect(),w=T.width,S=m.clientX-T.left,Y=t.offsetWidth,q=100,W=w-q-Y,B=Math.max(q,Math.min(S,W));r.style.width=B+"px",o.style.width=w-B-Y+"px",e=B/(w-Y)}),document.addEventListener("mouseup",()=>{l&&(l=!1,t.classList.remove("active"),t.classList.remove("hover"),document.body.style.cursor="default",document.body.style.userSelect="")}),window.addEventListener("resize",()=>{const T=a.getBoundingClientRect().width,w=t.offsetWidth,S=T-w,Y=S*e,q=S*(1-e);r.style.width=Y+"px",o.style.width=q+"px"})},Sn=(e,t)=>{let r=e.getValue()!==et;(t||r)&&!window.confirm(yn)||(tt(e,et),document.querySelectorAll(".column").forEach(o=>{o.scrollTo({top:0})}))};function d(e,t){const r=e.getModel();let o=e.getSelection(),a=r.getValueInRange(o);e.pushUndoStop();for(const m of An)if(t.match(m)){e.executeEdits("preview",[{range:o,text:t,forceMoveMarkers:!0}]);const w=o.getStartPosition();e.setPosition({lineNumber:w.lineNumber,column:w.column+t.length}),e.focus();return}if(t.match(bn)){e.executeEdits("preview",[{range:o,text:t,forceMoveMarkers:!0}]);const m=o.getStartPosition();e.setPosition({lineNumber:m.lineNumber,column:m.column+t.length}),e.focus();return}const l=t.split("=")[0];if(ot.includes(l))if(t==="-----"){e.executeEdits("preview",[{range:o,text:"-----",forceMoveMarkers:!0}]);const m=o.getStartPosition();e.setPosition({lineNumber:m.lineNumber,column:m.column+5})}else if(a||t.startsWith("color="))e.executeEdits("preview",[{range:o,text:`[${t}]${a}[/${t.split("=")[0]}]`,forceMoveMarkers:!0}]);else if(a)e.executeEdits("preview",[{range:o,text:`[${t}]${a}[/${t}]`,forceMoveMarkers:!0}]);else{const m=`[${t}][/${t}]`;e.executeEdits("preview",[{range:o,text:m,forceMoveMarkers:!0}]);const T=o.getStartPosition();e.setPosition({lineNumber:T.lineNumber,column:T.column+t.length+2}),e.pushUndoStop(),e.focus()}}let Re=null;function Ct(){Re&&!Re.closed?Re.focus():Re=window.open("./src/colorPicker.html","Color Picker","width=300,height=400,resizable=yes")}let Ce=null;function Mt(){Ce&&!Ce.closed?Ce.focus():Ce=window.open("./src/mentionPicker.html","Mention Picker","width=300,height=500,resizable=yes")}const Dt=document.querySelectorAll(".mention-preview-inline");Dt.forEach(e=>{e.addEventListener("click",()=>{Dt.forEach(t=>t.classList.remove("selected")),e.classList.add("selected"),insertIntoEditor(e.dataset.type)})});const U=class U{};Z(U,"localStorage",window.localStorage),Z(U,"sessionStorage",window.sessionStorage),Z(U,"createKey",function(t,r){return this.getMD5Hash([t,r].join("-"))}),Z(U,"getItem",function(t,r){var o=this.createKey(t,r),a=JSON.parse(sessionStorage.getItem(o))||JSON.parse(localStorage.getItem(o));if(a){var l=a.value,m=Number(a.expire),T=new Date().getTime();if(m){if(m>T)return l;deleteItem(t,r)}else return l}}),Z(U,"setItem",function(t,r,o,a){var l={namespace:t,key:r,value:o};a?(l.expire=a.getTime(),localStorage.setItem(this.createKey(t,r),JSON.stringify(l))):sessionStorage.setItem(this.createKey(t,r),JSON.stringify(l))}),Z(U,"deleteItem",function(t,r){sessionStorage.removeItem(this.createKey(t,r)),localStorage.removeItem(this.createKey(t,r))}),Z(U,"getInstance",function(t){return{getItem:function(r){return U.getItem(t,r)},setItem:function(r,o,a){U.setItem(t,r,o,a)},deleteItem:function(r){U.deleteItem(t,r)}}}),Z(U,"getMD5Hash",function(t){var r=new Array(0,3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745),o=new Array(new Array(0,7,1),new Array(1,12,2),new Array(2,17,3),new Array(3,22,4),new Array(4,7,5),new Array(5,12,6),new Array(6,17,7),new Array(7,22,8),new Array(8,7,9),new Array(9,12,10),new Array(10,17,11),new Array(11,22,12),new Array(12,7,13),new Array(13,12,14),new Array(14,17,15),new Array(15,22,16)),a=new Array(new Array(1,5,17),new Array(6,9,18),new Array(11,14,19),new Array(0,20,20),new Array(5,5,21),new Array(10,9,22),new Array(15,14,23),new Array(4,20,24),new Array(9,5,25),new Array(14,9,26),new Array(3,14,27),new Array(8,20,28),new Array(13,5,29),new Array(2,9,30),new Array(7,14,31),new Array(12,20,32)),l=new Array(new Array(5,4,33),new Array(8,11,34),new Array(11,16,35),new Array(14,23,36),new Array(1,4,37),new Array(4,11,38),new Array(7,16,39),new Array(10,23,40),new Array(13,4,41),new Array(0,11,42),new Array(3,16,43),new Array(6,23,44),new Array(9,4,45),new Array(12,11,46),new Array(15,16,47),new Array(2,23,48)),m=new Array(new Array(0,6,49),new Array(7,10,50),new Array(14,15,51),new Array(5,21,52),new Array(12,6,53),new Array(3,10,54),new Array(10,15,55),new Array(1,21,56),new Array(8,6,57),new Array(15,10,58),new Array(6,15,59),new Array(13,21,60),new Array(4,6,61),new Array(11,10,62),new Array(2,15,63),new Array(9,21,64));function T(p,h,y){return p&h|~p&y}function w(p,h,y){return p&y|h&~y}function S(p,h,y){return p^h^y}function Y(p,h,y){return h^(p|~y)}var q=new Array(new Array(T,o),new Array(w,a),new Array(S,l),new Array(Y,m));function W(p){return String.fromCharCode(p&255)+String.fromCharCode(p>>>8&255)+String.fromCharCode(p>>>16&255)+String.fromCharCode(p>>>24&255)}function B(p){for(;p<0;)p+=4294967296;for(;p>4294967295;)p-=4294967296;return p}function Q(p,h,y,g,x){var P,H,j,ee,te,u,v,L,K;P=g[0],H=g[1],j=g[2],ee=g[3],te=x[0],u=x[1],v=x[2],K=y(h[H],h[j],h[ee]),L=h[P]+K+p[te]+r[v],L=B(L),L=L<<u|L>>>32-u,L+=h[H],h[P]=B(L)}function Pe(p){var h,y,g,x,P,H,j,ee,te,u,v,L,K;if(g=new Array(1732584193,4023233417,2562383102,271733878),P=p.length,H=P&63,j=H<56?56-H:120-H,j>0)for(p+="",u=0;u<j-1;u++)p+="\0";for(p+=W(P*8),p+=W(0),P+=j+8,h=new Array(0,1,2,3),y=new Array(16),x=new Array(4),L=0;L<P;L+=64){for(u=0,v=L;u<16;u++,v+=4)y[u]=p.charCodeAt(v)|p.charCodeAt(v+1)<<8|p.charCodeAt(v+2)<<16|p.charCodeAt(v+3)<<24;for(u=0;u<4;u++)x[u]=g[u];for(u=0;u<4;u++)for(ee=q[u][0],te=q[u][1],v=0;v<16;v++)Q(y,x,ee,h,te[v]),K=h[0],h[0]=h[3],h[3]=h[2],h[2]=h[1],h[1]=K;for(u=0;u<4;u++)g[u]+=x[u],g[u]=B(g[u])}return W(g[0])+W(g[1])+W(g[2])+W(g[3])}function Ue(p){var h,y,g,x;for(x=Pe(p),y="",h=0;h<16;h++)g=x.charCodeAt(h),y+="0123456789abcdef".charAt(g>>4&15),y+="0123456789abcdef".charAt(g&15);return y}return Ue(t)});let J=U;const de="com.markdownlivepreview",Gt="last_state",Yt="scroll_bar_settings",qt="tool_bar_style_settings",xn=()=>J.getItem(de,Gt),vn=e=>{const t=new Date(2099,1,1);J.setItem(de,Gt,e,t)},Ln=()=>J.getItem(de,Yt)||!1,In=e=>{const t=new Date(2099,1,1);J.setItem(de,Yt,e,t)},Rn=()=>J.getItem(de,qt)||!1,Cn=e=>{const t=new Date(2099,1,1);J.setItem(de,qt,e,t)};let Me=null;function Ot(){Me&&!Me.closed?Me.focus():Me=window.open("./src/navigationPicker.html","Navigation Picker","width=500,height=450,resizable=yes")}const Mn=document.getElementById("toolbar-style-simple"),Dn=document.getElementById("toolbar-style-menubar");function On(e){const t={undoBtn:()=>e.trigger("keyboard","undo",null),undoBtn2:()=>e.trigger("keyboard","undo",null),redoBtn:()=>e.trigger("keyboard","redo",null),redoBtn2:()=>e.trigger("keyboard","redo",null),cutBtn:()=>r("editor.action.clipboardCutAction"),cutBtn2:()=>r("editor.action.clipboardCutAction"),copyBtn:()=>r("editor.action.clipboardCopyAction"),copyBtn2:()=>r("editor.action.clipboardCopyAction"),pasteBtn:()=>r("editor.action.clipboardPasteAction"),pasteBtn2:()=>r("editor.action.clipboardPasteAction"),deleteBtn:()=>r("editor.action.clipboardDeleteAction"),deleteBtn2:()=>r("editor.action.clipboardDeleteAction"),bold:()=>d(e,"b"),bold2:()=>d(e,"b"),italic:()=>d(e,"i"),italic2:()=>d(e,"i"),underline:()=>d(e,"u"),underline2:()=>d(e,"u"),strikethrough:()=>d(e,"s"),strikethrough2:()=>d(e,"s"),"align-left":()=>d(e,"left"),"align-left2":()=>d(e,"left"),"align-center":()=>d(e,"center"),"align-center2":()=>d(e,"center"),"align-right":()=>d(e,"right"),"align-right2":()=>d(e,"right"),sub:()=>d(e,"sub"),sub2:()=>d(e,"sub"),sup:()=>d(e,"sup"),sup2:()=>d(e,"sup"),line:()=>d(e,"-----"),line2:()=>d(e,"-----"),color:Ct,color2:Ct,mention:Mt,mention2:Mt,navigation:Ot,navigation2:Ot,h1:()=>d(e,"h1"),h2:()=>d(e,"h2"),h3:()=>d(e,"h3"),h4:()=>d(e,"h4"),h5:()=>d(e,"h5"),h1_2:()=>d(e,"h1"),h2_2:()=>d(e,"h2"),h3_2:()=>d(e,"h3"),h4_2:()=>d(e,"h4"),h5_2:()=>d(e,"h5"),quote:()=>d(e,"quote"),quote2:()=>d(e,"quote")};function r(o){e.focus(),e.trigger("toolbar",o)}Object.entries(t).forEach(([o,a])=>{const l=document.getElementById(o);l&&l.addEventListener("click",a)}),window.addEventListener("colorSelected",o=>{Nn(e,o)}),window.addEventListener("mentionSelected",o=>{kn(e,o)}),window.addEventListener("message",o=>{o.data&&o.data.type==="navigationLinksSelected"&&Pn(e,o)})}function Nn(e,t){const r=t.detail;r&&d(e,`color=${r}`)}function kn(e,t){const r=t.detail;r&&d(e,r)}function Pn(e,t){console.log("Received message:",t.data);const{prevId:r,firstId:o,nextId:a}=t.data.data;console.log("Inserting:",r,o,a),d(e,`[${r},${o},${a}]`)}let Un=(e,t)=>{let r=document.querySelector("#sync-scroll-checkbox");r.checked=e,t(e),r.addEventListener("change",o=>{let a=o.currentTarget.checked;t(a),In(a)})},Bn=(e,t)=>{let r=document.querySelector("#toolbar-style-checkbox");r.checked=e,r.addEventListener("change",o=>{let a=o.currentTarget.checked;Cn(a),Mn.style.display=a?"none":"flex",Dn.style.display=a?"flex":"none"})};/*! @license DOMPurify 3.2.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.5/LICENSE */const{entries:jt,setPrototypeOf:Nt,isFrozen:Fn,getPrototypeOf:$n,getOwnPropertyDescriptor:Wn}=Object;let{freeze:O,seal:F,create:Kt}=Object,{apply:nt,construct:rt}=typeof Reflect<"u"&&Reflect;O||(O=function(t){return t});F||(F=function(t){return t});nt||(nt=function(t,r,o){return t.apply(r,o)});rt||(rt=function(t,r){return new t(...r)});const De=N(Array.prototype.forEach),Hn=N(Array.prototype.lastIndexOf),kt=N(Array.prototype.pop),ye=N(Array.prototype.push),zn=N(Array.prototype.splice),Ne=N(String.prototype.toLowerCase),Ve=N(String.prototype.toString),Pt=N(String.prototype.match),Ae=N(String.prototype.replace),Gn=N(String.prototype.indexOf),Yn=N(String.prototype.trim),$=N(Object.prototype.hasOwnProperty),D=N(RegExp.prototype.test),be=qn(TypeError);function N(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return nt(e,t,o)}}function qn(e){return function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return rt(e,r)}}function f(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ne;Nt&&Nt(e,null);let o=t.length;for(;o--;){let a=t[o];if(typeof a=="string"){const l=r(a);l!==a&&(Fn(t)||(t[o]=l),a=l)}e[a]=!0}return e}function jn(e){for(let t=0;t<e.length;t++)$(e,t)||(e[t]=null);return e}function re(e){const t=Kt(null);for(const[r,o]of jt(e))$(e,r)&&(Array.isArray(o)?t[r]=jn(o):o&&typeof o=="object"&&o.constructor===Object?t[r]=re(o):t[r]=o);return t}function Te(e,t){for(;e!==null;){const o=Wn(e,t);if(o){if(o.get)return N(o.get);if(typeof o.value=="function")return N(o.value)}e=$n(e)}function r(){return null}return r}const Ut=O(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Xe=O(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ze=O(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Kn=O(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Je=O(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Vn=O(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Bt=O(["#text"]),Ft=O(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Qe=O(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),$t=O(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Oe=O(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Xn=F(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Zn=F(/<%[\w\W]*|[\w\W]*%>/gm),Jn=F(/\$\{[\w\W]*/gm),Qn=F(/^data-[\-\w.\u00B7-\uFFFF]+$/),er=F(/^aria-[\-\w]+$/),Vt=F(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),tr=F(/^(?:\w+script|data):/i),nr=F(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Xt=F(/^html$/i),rr=F(/^[a-z][.\w]*(-[.\w]+)+$/i);var Wt=Object.freeze({__proto__:null,ARIA_ATTR:er,ATTR_WHITESPACE:nr,CUSTOM_ELEMENT:rr,DATA_ATTR:Qn,DOCTYPE_NAME:Xt,ERB_EXPR:Zn,IS_ALLOWED_URI:Vt,IS_SCRIPT_OR_DATA:tr,MUSTACHE_EXPR:Xn,TMPLIT_EXPR:Jn});const we={element:1,text:3,progressingInstruction:7,comment:8,document:9},or=function(){return typeof window>"u"?null:window},ir=function(t,r){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let o=null;const a="data-tt-policy-suffix";r&&r.hasAttribute(a)&&(o=r.getAttribute(a));const l="dompurify"+(o?"#"+o:"");try{return t.createPolicy(l,{createHTML(m){return m},createScriptURL(m){return m}})}catch{return console.warn("TrustedTypes policy "+l+" could not be created."),null}},Ht=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Zt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:or();const t=c=>Zt(c);if(t.version="3.2.5",t.removed=[],!e||!e.document||e.document.nodeType!==we.document||!e.Element)return t.isSupported=!1,t;let{document:r}=e;const o=r,a=o.currentScript,{DocumentFragment:l,HTMLTemplateElement:m,Node:T,Element:w,NodeFilter:S,NamedNodeMap:Y=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:q,DOMParser:W,trustedTypes:B}=e,Q=w.prototype,Pe=Te(Q,"cloneNode"),Ue=Te(Q,"remove"),p=Te(Q,"nextSibling"),h=Te(Q,"childNodes"),y=Te(Q,"parentNode");if(typeof m=="function"){const c=r.createElement("template");c.content&&c.content.ownerDocument&&(r=c.content.ownerDocument)}let g,x="";const{implementation:P,createNodeIterator:H,createDocumentFragment:j,getElementsByTagName:ee}=r,{importNode:te}=o;let u=Ht();t.isSupported=typeof jt=="function"&&typeof y=="function"&&P&&P.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:v,ERB_EXPR:L,TMPLIT_EXPR:K,DATA_ATTR:en,ARIA_ATTR:tn,IS_SCRIPT_OR_DATA:nn,ATTR_WHITESPACE:it,CUSTOM_ELEMENT:rn}=Wt;let{IS_ALLOWED_URI:at}=Wt,_=null;const st=f({},[...Ut,...Xe,...Ze,...Je,...Bt]);let I=null;const lt=f({},[...Ft,...Qe,...$t,...Oe]);let b=Object.seal(Kt(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),me=null,Be=null,ct=!0,Fe=!0,ut=!1,ft=!0,ie=!1,$e=!0,ne=!1,We=!1,He=!1,ae=!1,_e=!1,Ee=!1,dt=!0,mt=!1;const on="user-content-";let ze=!0,pe=!1,se={},le=null;const pt=f({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let gt=null;const ht=f({},["audio","video","img","source","image","track"]);let Ge=null;const yt=f({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Se="http://www.w3.org/1998/Math/MathML",xe="http://www.w3.org/2000/svg",V="http://www.w3.org/1999/xhtml";let ce=V,Ye=!1,qe=null;const an=f({},[Se,xe,V],Ve);let ve=f({},["mi","mo","mn","ms","mtext"]),Le=f({},["annotation-xml"]);const sn=f({},["title","style","font","a","script"]);let ge=null;const ln=["application/xhtml+xml","text/html"],cn="text/html";let E=null,ue=null;const un=r.createElement("form"),At=function(n){return n instanceof RegExp||n instanceof Function},je=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ue&&ue===n)){if((!n||typeof n!="object")&&(n={}),n=re(n),ge=ln.indexOf(n.PARSER_MEDIA_TYPE)===-1?cn:n.PARSER_MEDIA_TYPE,E=ge==="application/xhtml+xml"?Ve:Ne,_=$(n,"ALLOWED_TAGS")?f({},n.ALLOWED_TAGS,E):st,I=$(n,"ALLOWED_ATTR")?f({},n.ALLOWED_ATTR,E):lt,qe=$(n,"ALLOWED_NAMESPACES")?f({},n.ALLOWED_NAMESPACES,Ve):an,Ge=$(n,"ADD_URI_SAFE_ATTR")?f(re(yt),n.ADD_URI_SAFE_ATTR,E):yt,gt=$(n,"ADD_DATA_URI_TAGS")?f(re(ht),n.ADD_DATA_URI_TAGS,E):ht,le=$(n,"FORBID_CONTENTS")?f({},n.FORBID_CONTENTS,E):pt,me=$(n,"FORBID_TAGS")?f({},n.FORBID_TAGS,E):{},Be=$(n,"FORBID_ATTR")?f({},n.FORBID_ATTR,E):{},se=$(n,"USE_PROFILES")?n.USE_PROFILES:!1,ct=n.ALLOW_ARIA_ATTR!==!1,Fe=n.ALLOW_DATA_ATTR!==!1,ut=n.ALLOW_UNKNOWN_PROTOCOLS||!1,ft=n.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ie=n.SAFE_FOR_TEMPLATES||!1,$e=n.SAFE_FOR_XML!==!1,ne=n.WHOLE_DOCUMENT||!1,ae=n.RETURN_DOM||!1,_e=n.RETURN_DOM_FRAGMENT||!1,Ee=n.RETURN_TRUSTED_TYPE||!1,He=n.FORCE_BODY||!1,dt=n.SANITIZE_DOM!==!1,mt=n.SANITIZE_NAMED_PROPS||!1,ze=n.KEEP_CONTENT!==!1,pe=n.IN_PLACE||!1,at=n.ALLOWED_URI_REGEXP||Vt,ce=n.NAMESPACE||V,ve=n.MATHML_TEXT_INTEGRATION_POINTS||ve,Le=n.HTML_INTEGRATION_POINTS||Le,b=n.CUSTOM_ELEMENT_HANDLING||{},n.CUSTOM_ELEMENT_HANDLING&&At(n.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(b.tagNameCheck=n.CUSTOM_ELEMENT_HANDLING.tagNameCheck),n.CUSTOM_ELEMENT_HANDLING&&At(n.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(b.attributeNameCheck=n.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),n.CUSTOM_ELEMENT_HANDLING&&typeof n.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(b.allowCustomizedBuiltInElements=n.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ie&&(Fe=!1),_e&&(ae=!0),se&&(_=f({},Bt),I=[],se.html===!0&&(f(_,Ut),f(I,Ft)),se.svg===!0&&(f(_,Xe),f(I,Qe),f(I,Oe)),se.svgFilters===!0&&(f(_,Ze),f(I,Qe),f(I,Oe)),se.mathMl===!0&&(f(_,Je),f(I,$t),f(I,Oe))),n.ADD_TAGS&&(_===st&&(_=re(_)),f(_,n.ADD_TAGS,E)),n.ADD_ATTR&&(I===lt&&(I=re(I)),f(I,n.ADD_ATTR,E)),n.ADD_URI_SAFE_ATTR&&f(Ge,n.ADD_URI_SAFE_ATTR,E),n.FORBID_CONTENTS&&(le===pt&&(le=re(le)),f(le,n.FORBID_CONTENTS,E)),ze&&(_["#text"]=!0),ne&&f(_,["html","head","body"]),_.table&&(f(_,["tbody"]),delete me.tbody),n.TRUSTED_TYPES_POLICY){if(typeof n.TRUSTED_TYPES_POLICY.createHTML!="function")throw be('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof n.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw be('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');g=n.TRUSTED_TYPES_POLICY,x=g.createHTML("")}else g===void 0&&(g=ir(B,a)),g!==null&&typeof x=="string"&&(x=g.createHTML(""));O&&O(n),ue=n}},bt=f({},[...Xe,...Ze,...Kn]),Tt=f({},[...Je,...Vn]),fn=function(n){let i=y(n);(!i||!i.tagName)&&(i={namespaceURI:ce,tagName:"template"});const s=Ne(n.tagName),A=Ne(i.tagName);return qe[n.namespaceURI]?n.namespaceURI===xe?i.namespaceURI===V?s==="svg":i.namespaceURI===Se?s==="svg"&&(A==="annotation-xml"||ve[A]):!!bt[s]:n.namespaceURI===Se?i.namespaceURI===V?s==="math":i.namespaceURI===xe?s==="math"&&Le[A]:!!Tt[s]:n.namespaceURI===V?i.namespaceURI===xe&&!Le[A]||i.namespaceURI===Se&&!ve[A]?!1:!Tt[s]&&(sn[s]||!bt[s]):!!(ge==="application/xhtml+xml"&&qe[n.namespaceURI]):!1},z=function(n){ye(t.removed,{element:n});try{y(n).removeChild(n)}catch{Ue(n)}},Ie=function(n,i){try{ye(t.removed,{attribute:i.getAttributeNode(n),from:i})}catch{ye(t.removed,{attribute:null,from:i})}if(i.removeAttribute(n),n==="is")if(ae||_e)try{z(i)}catch{}else try{i.setAttribute(n,"")}catch{}},wt=function(n){let i=null,s=null;if(He)n="<remove></remove>"+n;else{const R=Pt(n,/^[\r\n\t ]+/);s=R&&R[0]}ge==="application/xhtml+xml"&&ce===V&&(n='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+n+"</body></html>");const A=g?g.createHTML(n):n;if(ce===V)try{i=new W().parseFromString(A,ge)}catch{}if(!i||!i.documentElement){i=P.createDocument(ce,"template",null);try{i.documentElement.innerHTML=Ye?x:A}catch{}}const C=i.body||i.documentElement;return n&&s&&C.insertBefore(r.createTextNode(s),C.childNodes[0]||null),ce===V?ee.call(i,ne?"html":"body")[0]:ne?i.documentElement:C},_t=function(n){return H.call(n.ownerDocument||n,n,S.SHOW_ELEMENT|S.SHOW_COMMENT|S.SHOW_TEXT|S.SHOW_PROCESSING_INSTRUCTION|S.SHOW_CDATA_SECTION,null)},Ke=function(n){return n instanceof q&&(typeof n.nodeName!="string"||typeof n.textContent!="string"||typeof n.removeChild!="function"||!(n.attributes instanceof Y)||typeof n.removeAttribute!="function"||typeof n.setAttribute!="function"||typeof n.namespaceURI!="string"||typeof n.insertBefore!="function"||typeof n.hasChildNodes!="function")},Et=function(n){return typeof T=="function"&&n instanceof T};function X(c,n,i){De(c,s=>{s.call(t,n,i,ue)})}const St=function(n){let i=null;if(X(u.beforeSanitizeElements,n,null),Ke(n))return z(n),!0;const s=E(n.nodeName);if(X(u.uponSanitizeElement,n,{tagName:s,allowedTags:_}),n.hasChildNodes()&&!Et(n.firstElementChild)&&D(/<[/\w!]/g,n.innerHTML)&&D(/<[/\w!]/g,n.textContent)||n.nodeType===we.progressingInstruction||$e&&n.nodeType===we.comment&&D(/<[/\w]/g,n.data))return z(n),!0;if(!_[s]||me[s]){if(!me[s]&&vt(s)&&(b.tagNameCheck instanceof RegExp&&D(b.tagNameCheck,s)||b.tagNameCheck instanceof Function&&b.tagNameCheck(s)))return!1;if(ze&&!le[s]){const A=y(n)||n.parentNode,C=h(n)||n.childNodes;if(C&&A){const R=C.length;for(let k=R-1;k>=0;--k){const G=Pe(C[k],!0);G.__removalCount=(n.__removalCount||0)+1,A.insertBefore(G,p(n))}}}return z(n),!0}return n instanceof w&&!fn(n)||(s==="noscript"||s==="noembed"||s==="noframes")&&D(/<\/no(script|embed|frames)/i,n.innerHTML)?(z(n),!0):(ie&&n.nodeType===we.text&&(i=n.textContent,De([v,L,K],A=>{i=Ae(i,A," ")}),n.textContent!==i&&(ye(t.removed,{element:n.cloneNode()}),n.textContent=i)),X(u.afterSanitizeElements,n,null),!1)},xt=function(n,i,s){if(dt&&(i==="id"||i==="name")&&(s in r||s in un))return!1;if(!(Fe&&!Be[i]&&D(en,i))){if(!(ct&&D(tn,i))){if(!I[i]||Be[i]){if(!(vt(n)&&(b.tagNameCheck instanceof RegExp&&D(b.tagNameCheck,n)||b.tagNameCheck instanceof Function&&b.tagNameCheck(n))&&(b.attributeNameCheck instanceof RegExp&&D(b.attributeNameCheck,i)||b.attributeNameCheck instanceof Function&&b.attributeNameCheck(i))||i==="is"&&b.allowCustomizedBuiltInElements&&(b.tagNameCheck instanceof RegExp&&D(b.tagNameCheck,s)||b.tagNameCheck instanceof Function&&b.tagNameCheck(s))))return!1}else if(!Ge[i]){if(!D(at,Ae(s,it,""))){if(!((i==="src"||i==="xlink:href"||i==="href")&&n!=="script"&&Gn(s,"data:")===0&&gt[n])){if(!(ut&&!D(nn,Ae(s,it,"")))){if(s)return!1}}}}}}return!0},vt=function(n){return n!=="annotation-xml"&&Pt(n,rn)},Lt=function(n){X(u.beforeSanitizeAttributes,n,null);const{attributes:i}=n;if(!i||Ke(n))return;const s={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:I,forceKeepAttr:void 0};let A=i.length;for(;A--;){const C=i[A],{name:R,namespaceURI:k,value:G}=C,he=E(R);let M=R==="value"?G:Yn(G);if(s.attrName=he,s.attrValue=M,s.keepAttr=!0,s.forceKeepAttr=void 0,X(u.uponSanitizeAttribute,n,s),M=s.attrValue,mt&&(he==="id"||he==="name")&&(Ie(R,n),M=on+M),$e&&D(/((--!?|])>)|<\/(style|title)/i,M)){Ie(R,n);continue}if(s.forceKeepAttr||(Ie(R,n),!s.keepAttr))continue;if(!ft&&D(/\/>/i,M)){Ie(R,n);continue}ie&&De([v,L,K],Rt=>{M=Ae(M,Rt," ")});const It=E(n.nodeName);if(xt(It,he,M)){if(g&&typeof B=="object"&&typeof B.getAttributeType=="function"&&!k)switch(B.getAttributeType(It,he)){case"TrustedHTML":{M=g.createHTML(M);break}case"TrustedScriptURL":{M=g.createScriptURL(M);break}}try{k?n.setAttributeNS(k,R,M):n.setAttribute(R,M),Ke(n)?z(n):kt(t.removed)}catch{}}}X(u.afterSanitizeAttributes,n,null)},dn=function c(n){let i=null;const s=_t(n);for(X(u.beforeSanitizeShadowDOM,n,null);i=s.nextNode();)X(u.uponSanitizeShadowNode,i,null),St(i),Lt(i),i.content instanceof l&&c(i.content);X(u.afterSanitizeShadowDOM,n,null)};return t.sanitize=function(c){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=null,s=null,A=null,C=null;if(Ye=!c,Ye&&(c="<!-->"),typeof c!="string"&&!Et(c))if(typeof c.toString=="function"){if(c=c.toString(),typeof c!="string")throw be("dirty is not a string, aborting")}else throw be("toString is not a function");if(!t.isSupported)return c;if(We||je(n),t.removed=[],typeof c=="string"&&(pe=!1),pe){if(c.nodeName){const G=E(c.nodeName);if(!_[G]||me[G])throw be("root node is forbidden and cannot be sanitized in-place")}}else if(c instanceof T)i=wt("<!---->"),s=i.ownerDocument.importNode(c,!0),s.nodeType===we.element&&s.nodeName==="BODY"||s.nodeName==="HTML"?i=s:i.appendChild(s);else{if(!ae&&!ie&&!ne&&c.indexOf("<")===-1)return g&&Ee?g.createHTML(c):c;if(i=wt(c),!i)return ae?null:Ee?x:""}i&&He&&z(i.firstChild);const R=_t(pe?c:i);for(;A=R.nextNode();)St(A),Lt(A),A.content instanceof l&&dn(A.content);if(pe)return c;if(ae){if(_e)for(C=j.call(i.ownerDocument);i.firstChild;)C.appendChild(i.firstChild);else C=i;return(I.shadowroot||I.shadowrootmode)&&(C=te.call(o,C,!0)),C}let k=ne?i.outerHTML:i.innerHTML;return ne&&_["!doctype"]&&i.ownerDocument&&i.ownerDocument.doctype&&i.ownerDocument.doctype.name&&D(Xt,i.ownerDocument.doctype.name)&&(k="<!DOCTYPE "+i.ownerDocument.doctype.name+`>
`+k),ie&&De([v,L,K],G=>{k=Ae(k,G," ")}),g&&Ee?g.createHTML(k):k},t.setConfig=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};je(c),We=!0},t.clearConfig=function(){ue=null,We=!1},t.isValidAttribute=function(c,n,i){ue||je({});const s=E(c),A=E(n);return xt(s,A,i)},t.addHook=function(c,n){typeof n=="function"&&ye(u[c],n)},t.removeHook=function(c,n){if(n!==void 0){const i=Hn(u[c],n);return i===-1?void 0:zn(u[c],i,1)[0]}return kt(u[c])},t.removeHooks=function(c){u[c]=[]},t.removeAllHooks=function(){u=Ht()},t}var ar=Zt();const Jt=e=>`
<a href="https://www.furaffinity.net/user/${e}" class="fa-username">`,Qt=e=>`
<img src="https://a.facdn.net/${e}.gif"
    alt="${e}"
    class="fa-icon"
    onerror="this.style.display='none'">`,fe=(e,{includeGif:t=!1,single:r=!1,showText:o=!0,prefix:a=""}={})=>`
<span class="fa-mention${r?" single":""}">
    ${Jt(e)}
    ${t?Qt(e):""}
    ${o?a+e:""}
</a>
</span>`,sr=[{id:"Normalize line endings",html:`
`,regex:/\r\n?/g},{id:"Convert to breaks",html:"<br>",regex:/\n/g},...zt([1,2,3,4,5],{prefix:"h",classPrefix:"h"}),{id:"Remove breaks right after headers",html:"$1",regex:/(<\/h[1-6]>)<br>/gi},...zt(["b","i","u","s"]),{id:"Spoiler",html:'<span class="bbcode_spoiler">$1</span>',regex:/\[spoiler](.*?)\[\/spoiler]/gi},{id:"Quote",html:'<span class="bbcode_quote">$1</span>',regex:/\[quote](.*?)\[\/quote]/gi},{id:"left",html:'<div class="bbcode_left">$1</div>',regex:/\[left](.*?)\[\/left]/gi},{id:"center",html:'<div class="bbcode_center">$1</div>',regex:/\[center](.*?)\[\/center]/gi},{id:"right",html:'<div class="bbcode_right">$1</div>',regex:/\[right](.*?)\[\/right]/gi},{id:"Copyright Symbol",html:"©",regex:/\(c\)/gi},{id:"Trademark Symbol",html:"™",regex:/\(tm\)/gi},{id:"Registered Symbol",html:"®",regex:/\(r\)/gi},{id:"Plain URL",html:e=>`<a href="${e}" class="bbcode_link" target="_blank" rel="noopener noreferrer">${e}</a>`,regex:new RegExp("(?<!\\[url=|])https?:\\/\\/[^\\s<]+","gi")},{id:"Url=",html:'<a href="$1" class="bbcode_link" target="_blank" rel="noopener noreferrer">$2</a>',regex:/\[url=(https?:\/\/[^\]]+)](.*?)\[\/url]/gi},{id:"Url",html:'<a href="$1" class="bbcode_link" target="_blank" rel="noopener noreferrer">$1</a>',regex:/\[url](https?:\/\/[^\]]+)\[\/url]/gi},{id:"Color=",html:'<span class="bbcode_color" style="color:$1;">$2</span>',regex:/\[color=(#[0-9A-F]{3,6}|[a-z]+)](.*?)\[\/color]/gi},{id:"🐭Username(Legacy)",html:(e,t)=>fe(t,{includeGif:!0,single:!0,showText:!1}),regex:/:([a-z0-9_-]+)icon:/gi},{id:"🐭Username(Legacy2)",html:(e,t)=>fe(t,{includeGif:!0}),regex:/:icon([a-z0-9_-]+):/gi},{id:"🐭UsernameCombined",html:(e,t)=>{const r=fe(t,{includeGif:!0,single:!0,showText:!1}),o=fe(t,{single:!0});return`${r}${o}`},regex:/([a-z0-9_-]+)icon:@([a-z0-9_-]+)/gi},{id:"UsernameSimple",html:(e,t)=>fe(t,{single:!0,prefix:"@"}),regex:/@([a-zA-Z0-9_-]+)/gi},{id:"Bracketed Links",html:(e,t)=>{const r=t.split(",").map(m=>m.trim()),o=r[0]&&r[0]!=="-"?`<a href="https://www.furaffinity.net/view/${r[0]}" target="_blank" rel="noopener noreferrer"><<< PREV</a>`:"<<< PREV",a=r[1]&&r[1]!=="-"?`<a href="https://www.furaffinity.net/view/${r[1]}" target="_blank" rel="noopener noreferrer">FIRST</a>`:"FIRST",l=r[2]&&r[2]!=="-"?`<a href="https://www.furaffinity.net/view/${r[2]}" target="_blank" rel="noopener noreferrer">NEXT >>></a>`:"NEXT >>>";return`${o} | ${a} | ${l}`},regex:/\[\s*([0-9\-]+(?:\s*,\s*[0-9\-]+)*)\s*\]/g},{id:"sup",html:"<sup>$1</sup>",regex:/\[sup](.*?)\[\/sup]/gi},{id:"sub",html:"<sub>$1</sub>",regex:/\[sub](.*?)\[\/sub]/gi},{id:"line",html:'<hr class="bbcode bbcode_hr">',regex:/-{5,}/g}];function zt(e,{prefix:t="",classPrefix:r=""}={}){return e.map(o=>{const a=t?`${t}${o}`:o.charAt(0).toUpperCase()+o.slice(1),l=t?`${t}${o}`:o,m=r?`bbcode_${r}${o}`:`bbcode_${o}`;return{id:a,html:`<${l} class="${m}">$1</${l}>`,regex:new RegExp(`\\[${l}](.*?)\\[\\/${l}]`,"gi")}})}function lr(e){return e?e.replace(/\[yt](https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]+))\[\/yt]/gi,(t,r,o)=>`
        <div class="youtubeWrapper" data-video="${o}">
            <div class="youtubeWrapper__thumbnailContainer">
                <img class="youtubeWrapper__thumbnail" src="https://img.youtube.com/vi/${o}/maxresdefault.jpg" alt="YouTube Video">
                <div class="youtubeWrapper__playButton"></div>
            </div>
        </div>`):""}function cr(e){return e?(e=lr(e),sr.forEach(t=>{e=e.replace(t.regex,t.html)}),e):""}let ur=async e=>{let t=await new Promise(r=>{r(cr(e))});document.querySelector("#output").innerHTML=ar.sanitize(t)};window.a_href_fa_username=Jt;window.img_src_user_gif=Qt;window.faMention=fe;function fr(){document.addEventListener("click",e=>{const t=e.target.closest(".youtubeWrapper");if(!t)return;const r=t.dataset.video;t.innerHTML=`
        <iframe
            class="youtubeWrapper__iframe"
            src="https://www.youtube.com/embed/${r}?autoplay=1"
            frameborder="0"
            allow="autoplay; encrypted-media; fullscreen"
            allowfullscreen
        ></iframe>
    `})}function dr(){oe.languages.register({id:ke}),oe.languages.setMonarchTokensProvider(ke,{defaultToken:"",tokenizer:{root:[[new RegExp(Tn),"keyword"],[/\[[^\]]+]/,"identifier"],[/./,""]]}})}function mr(){oe.languages.registerCompletionItemProvider(ke,{triggerCharacters:["["],provideCompletionItems:(e,t)=>({suggestions:ot.map(r=>({label:r,kind:oe.languages.CompletionItemKind.Snippet,insertText:`${r}]$0[/${r}]`,insertTextRules:oe.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:`Insert [${r}]...[/ ${r}]`}))})})}function pr(){return oe.editor.defineTheme("furAffinityTheme",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#1b1b1d","editor.foreground":"#D4D4D4","editorLineNumber.foreground":"#858585","editorCursor.foreground":"#AEAFAD","editor.selectionBackground":"#264F78","editor.lineHighlightBackground":"#2A2A2A","scrollbar.shadow":"#00000000","scrollbarSlider.background":"#44475a88","scrollbarSlider.hoverBackground":"#555a7088","scrollbarSlider.activeBackground":"#666b8088"}}),oe.editor.create(document.querySelector("#editor"),{fontSize:14,language:ke,minimap:{enabled:!1},scrollBeyondLastLine:!1,automaticLayout:!0,scrollbar:{vertical:"visible",horizontal:"visible"},wordWrap:"on",hover:{enabled:!1},quickSuggestions:!0,suggestOnTriggerCharacters:!0,theme:"furAffinityTheme",folding:!1})}function gr(e){const t={b:"b",i:"i",u:"u",s:"s"};e.onKeyDown(r=>{const o=r.browserEvent.key.toLowerCase();(r.metaKey||r.ctrlKey)&&t[o]&&(r.preventDefault(),d(e,t[o]))})}function hr(e,t,r){e.onDidChangeModelContent(()=>{e.getValue();const o=e.getValue();ur(o).catch(a=>{console.error(a)}),r(o)})}function yr(e,t){e.onDidScrollChange(r=>{if(!t())return;const o=r.scrollTop,a=r.scrollHeight,l=e.getLayoutInfo().height,m=a-l,T=o/m;let w=document.querySelector("#preview"),S=(w.scrollHeight-w.clientHeight)*T;w.scrollTo(0,S)})}function Ar(e,t,r){dr();const o=pr();return o.focus(),mr(),gr(o),_n(o,e),wn(o),On(o),fr(),En(),hr(o,e,t),yr(o,r),o}function br(){self.MonacoEnvironment={getWorker(e,t){return new Worker(URL.createObjectURL(new Blob(["self.onmessage = () => {}"],{type:"application/javascript"})))}}}const Tr=()=>{br();let e=!1,t=Ar(l=>{},vn,()=>e),r=Ln()||!1;Un(r,l=>{e=l});let o=Rn()||!1;Bn(o);let a=xn();a?tt(t,a,l=>{}):tt(t,DEFAULT_INPUT,l=>{})};window.addEventListener("load",()=>{Tr()});
