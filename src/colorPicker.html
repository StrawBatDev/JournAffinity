<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="/JournAffinity/">
    <title>Color Picker</title>

</head>
<body>

<header>
    <h1>Choose a color</h1>
    <div class="color-preview"></div>
</header>

<div class="modal-container">
    <div class="color-grid"></div>
</div>


<div class="toolbar footer">
    <div class="input-group">
        <label for="color-input">Selected Colour: </label><input type="text" id="color-input" placeholder="Enter color name or #hex">
        <button id="apply-color">Apply</button>
    </div>
</div>

<script>
    import '../css/theme.css';
    import '../css/style.css';
    import '../css/preview.css';
    import '../css/modal.css';

    const faColors = [
        // BROWNS
        "Wheat", "Tan", "Khaki", "Burlywood", "Darkkhaki", "Rosybrown", "Sandybrown", "Peru", "Chocolate", "Sienna", "Saddlebrown", "Brown",
        // REDS
        "Mistyrose", "Pink", "Lightpink", "Darksalmon", "Lightsalmon", "Lightcoral", "Salmon", "Tomato", "Coral", "Indianred", "Hotpink", "Firebrick", "Crimson", "Red", "Darkred", "Maroon",
        // ORANGES
        "Peachpuff", "Moccasin", "Navajowhite", "Orange", "Darkorange", "Orangered",
        // YELLOWS
        "Lightgoldenrodyellow", "Lightyellow", "Lemonchiffon", "Palegoldenrod", "Yellow", "Gold", "Goldenrod", "Darkgoldenrod",
        // GREENS
        "Mintcream", "Honeydew", "Darkseagreen", "Lightgreen", "Palegreen", "Mediumspringgreen", "Springgreen", "Mediumseagreen", "Lightseagreen", "Seagreen", "Yellowgreen", "Greenyellow", "Lawngreen", "Chartreuse", "Lime", "Limegreen", "Forestgreen", "Green", "Darkgreen", "Darkolivegreen", "Olivedrab", "Olive",
        // BLUES
        "Aliceblue", "Azure", "Lightcyan", "Paleturquoise", "Powderblue", "Lightblue", "Lightsteelblue", "Skyblue", "Lightskyblue", "Aquamarine", "Mediumaquamarine", "Cadetblue", "Mediumturquoise", "Turquoise", "Aqua", "Cyan", "Darkturquoise", "Deepskyblue", "Dodgerblue", "Darkcyan", "Teal", "Cornflowerblue", "Steelblue", "Royalblue", "Blue", "Mediumblue", "Darkblue", "Navy", "Midnightblue", "Darkslateblue", "Slateblue",
        // PURPLES
        "Gainsboro", "Lavender", "Thistle", "Plum", "Violet", "Palevioletred", "Orchid", "Mediumorchid", "Mediumpurple", "Mediumslateblue", "Blueviolet", "Darkorchid", "Darkviolet", "Darkmagenta", "Purple", "Mediumvioletred", "Deeppink", "Magenta", "Fuchsia", "Indigo",
        // OTHER COLORS
        "Antiquewhite", "Beige", "Bisque", "Blanchedalmond", "Cornsilk", "Floralwhite", "Ghostwhite", "Ivory", "Lavenderblush", "Linen", "Oldlace", "Papayawhip", "Seashell", "Snow", "White", "Whitesmoke", "Darkgray", "Gray", "Lightgray", "Silver", "Dimgray", "Lightslategray", "Slategray", "Darkslategray", "Black"
    ];

    const preview = document.querySelector('.color-preview');

    document.addEventListener('DOMContentLoaded', () => {
        const grid = document.querySelector('.color-grid');
        const input = document.getElementById('color-input');
        const applyBtn = document.getElementById('apply-color');

        faColors.forEach(color => {
            const swatch = document.createElement('div');
            swatch.className = 'color-swatch';
            swatch.style.backgroundColor = color;
            swatch.title = color;
            swatch.addEventListener('click', () => {
                input.value = color;
                sendColorToOpener(color);
            });
            grid.appendChild(swatch);

            swatch.addEventListener('mouseenter', () => {
                updatePreview(color)
            });

            swatch.addEventListener('mouseleave', () => {
                updatePreview(color)
            });
        });

        applyBtn.addEventListener('click', () => {
            const color = input.value.trim();
            if (!color) return;
            sendColorToOpener(color);
        });

        function sendColorToOpener(color) {
            if (window.opener && !window.opener.closed) {
                // TODO - Consider using message instead of custom event
                const event = new CustomEvent('colorSelected', {detail: color});
                window.opener.dispatchEvent(event);
            } else {
                alert("This window has been orphaned and can't find its original editor window. Please close this window and re-open it.");
            }
        }

        function getContrastColor(bgColor) {
            const tempEl = document.createElement('div');
            tempEl.style.color = bgColor;
            document.body.appendChild(tempEl);

            const computed = getComputedStyle(tempEl).color; // get RGB
            document.body.removeChild(tempEl);

            const rgb = computed.match(/\d+/g).map(Number);
            const brightness = (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;

            return brightness > 125 ? '#000' : '#fff'; // dark text on light bg, white on dark bg
        }

        function updatePreview(color) {
            preview.style.background = color;
            preview.style.color = getContrastColor(color);
            preview.textContent = color;
        }
    });
</script>
</body>
</html>